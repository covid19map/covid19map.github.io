{"version":3,"sources":["components/data-map/layers-setup.js","components/data-map/data-map.js","utilities/data-mutations.js","utilities/formatting.js","components/data-panel/data-panel.js","components/loader/loader.js","data-mockup.js","App.js","utilities/interfaces.js","serviceWorker.js","index.js"],"names":["circleLayer","id","type","source","paint","countLayer","layout","DataMap","data","mapStyle","onClick","useState","width","height","latitude","longitude","zoom","viewport","setViewport","mapStyleURI","onViewportChange","mapboxApiAccessToken","style","position","bottom","right","__sum","x","y","__or","__ensureArray","__condenseDataset","prop","dataset","map","p","reduce","condenseData","props","r","Object","keys","forEach","t","condenseDataset","__filterPropValuePair","values","filter","array","possiblities","includes","__bigIntegerDisplayFormater","Intl","NumberFormat","bigIntegerDisplay","number","format","__percentageDisplayFormater","maximumSignificantDigits","percentageDisplay","DataPanelTiles","confirmed","deaths","recovered","cls","heading","DataPanelTile","children","className","DataPanelControls","onToggleFilters","onToggleCharts","FilterIcon","viewBox","d","ArrowLeftIcon","DataPanel","currentTime","chartsExpanded","confirmedValues","recoveredValues","deathsValues","condensedDataCurrent","controlHandlers","clsCharts","Loader","Array","key","__DATA__MOCKUP","1584820500000","province","country","latlng","active","1584820800000","1584820813832","permuteMapStyles","currentValue","console","log","LoadingIndicator","usePromiseTracker","delay","promiseInProgress","App","handleReload","document","location","reload","handleSwitchTheme","state","setState","handleSetLive","Date","now","handleToggleCharts","handleCollapseCharts","handleToggleFilters","filtersExpanded","handleCollapseFilters","setCountryFilter","filteredRegions","fetched","length","value","filtered","filterPropValuePair","setTime","unixtime","getLiveData","a","survey","registeredRegions","this","label","geoData","features","geodataFeatures","point","lat","lng","push","properties","Number","geometry","coordinates","interfaceOutGeoJSON","open","onClose","classNames","modal","center","isMulti","name","options","defaultValue","onChange","Component","Boolean","window","hostname","match","ReactDOM","render","getElementById","navigator","serviceWorker","ready","then","registration","unregister","catch","error","message"],"mappings":"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","file":"static/js/main.fee5fdc3.chunk.js","sourcesContent":["export const circleLayer = {\r\n  id: 'clusters',\r\n  type: 'circle',\r\n  source: 'covid-19',\r\n  paint: {\r\n    'circle-color': [\r\n      'step',\r\n      ['get', 'confirmed'],\r\n      '#03befc', 20,\r\n      '#f1f075', 800,\r\n      '#f28cb1', 5000,\r\n      '#ba1818'\r\n    ],\r\n    'circle-radius': [\r\n      'step',\r\n      ['zoom'], 4, 2, 6, 4, [\r\n        'interpolate',\r\n        ['cubic-bezier', 0, 0.5, 1, 0.5 ],\r\n        ['get', 'confirmed'],\r\n        20,  8,\r\n        5000, 25\r\n      ]\r\n    ],\r\n  }\r\n};\r\n\r\nexport const countLayer = {\r\n  id: 'cluster-count',\r\n  type: 'symbol',\r\n  source: 'covid-19',\r\n  layout: {\r\n    'text-field': ['get', 'confirmed'],\r\n    'text-font': ['DIN Offc Pro Medium', 'Arial Unicode MS Bold'],\r\n    'text-size': ['step', ['zoom'], 0, 4, 11],\r\n  }\r\n};\r\n","import React, { useState } from 'react';\r\nimport ReactMapGL, { Source, Layer, NavigationControl } from 'react-map-gl';\r\nimport { circleLayer, countLayer } from './layers-setup';\r\nimport 'mapbox-gl/dist/mapbox-gl.css';\r\n\r\nconst MAPBOX_TOKEN = 'pk.eyJ1IjoiZ2lhbm5vdHIiLCJhIjoiY2s3aHFkcDkwMGMzYjNlbzNvMWl4bGFxbyJ9.2p2O5m7aiA6Bn9vjPe7HrQ';\r\n\r\nconst DataMap = ({ data, mapStyle, onClick }) => {\r\n  const [viewport, setViewport] = useState({\r\n    width: '100vw',\r\n    height: '100vh',\r\n    latitude: 45,\r\n    longitude: 10,\r\n    zoom: 4,\r\n  });\r\n\r\n  const mapStyleURI = `mapbox://styles/mapbox/${mapStyle}`;\r\n\r\n  /*\r\n  const clusterParams = {\r\n    cluster: true,\r\n    clusterMaxZoom: 14,\r\n    clusterRadius: 50,\r\n    clusterProperties: { 'cluster_count': ['+', ['case', ['get', 'confirmed'], 1, 0]] },\r\n  }\r\n  */\r\n\r\n  return (\r\n    <ReactMapGL\r\n      {...viewport}\r\n      onViewportChange={setViewport}\r\n      mapboxApiAccessToken={MAPBOX_TOKEN}\r\n      mapStyle={mapStyleURI}\r\n      onClick={onClick}\r\n    >\r\n      <Source id=\"covid-19\" type=\"geojson\" data={data}>\r\n        <Layer {...circleLayer} />\r\n        <Layer {...countLayer} />\r\n      </Source>\r\n      <div style={{position: 'absolute', bottom: '40px', right: '20px'}}>\r\n        <NavigationControl />\r\n      </div>\r\n    </ReactMapGL>\r\n  );\r\n}\r\n\r\nexport default DataMap;\r\n","const __sum = (x, y) => x + y;\r\nconst __or = (x, y) => x || y;\r\nconst __ensureArray = (x) => {\r\n  if(typeof x !== 'object') {\r\n    x = [x];\r\n  }\r\n  return x;\r\n}\r\nconst __includesArray = (array, possiblities) => (\r\n  !!array ? possiblities.map(p => array.includes(p)).reduce(__or, false) : true\r\n)\r\n\r\n// B.F. TODO: Add tests!\r\n\r\nconst __condenseDataset = (prop, dataset) => (\r\n  !!prop ? dataset.map(p => p[prop]).reduce(__sum, 0) : 0\r\n);\r\n\r\nexport const condenseDataset = (props, dataset) => {\r\n  if(typeof props === 'object') {\r\n    return props.map(p => __condenseDataset(p, dataset)).reduce(__sum, 0);\r\n  } else {\r\n    return __condenseDataset(props, dataset);\r\n  }\r\n}\r\n\r\nexport const condenseData = (props, data) => {\r\n  const r = {}\r\n  Object.keys(data).forEach(t => {\r\n    r[t] = condenseDataset(props, data[t])\r\n  });\r\n  return r;\r\n}\r\n\r\nconst __filterProps = (props, dataset) => {\r\n  props = __ensureArray(props);\r\n  return dataset.map(p => Object.keys(p)\r\n    .filter(key => props.includes(key))\r\n    .reduce((obj, key) => {\r\n      obj[key] = p[key];\r\n      return obj;\r\n    }, {}));\r\n}\r\n\r\nexport const filterProps = (props, data) => {\r\n  const r = {}\r\n  Object.keys(data).forEach(t => {\r\n    r[t] = __filterProps(props, data[t])\r\n  });\r\n  return r;\r\n}\r\n\r\nconst __filterPropValuePair = (props, values, dataset) => (\r\n  dataset.filter(\r\n    p => __includesArray(values, __ensureArray(props).map(x => p[x]))\r\n  )\r\n);\r\n\r\nexport const filterPropValuePair = (props, values, data) => {\r\n  const r = {}\r\n  Object.keys(data).forEach(t => {\r\n    r[t] = __filterPropValuePair(props, values, data[t])\r\n  });\r\n  return r;\r\n}\r\n","export const pad = (num, size) => {\r\n  let s = num + '';\r\n  while(s.length < size) s = '0' + s;\r\n  return s;\r\n}\r\n\r\nconst __bigIntegerDisplayFormater = new Intl.NumberFormat('en-US');\r\n\r\nexport const bigIntegerDisplay = (number) => (\r\n  __bigIntegerDisplayFormater.format(number)\r\n);\r\n\r\nconst __percentageDisplayFormater = new Intl.NumberFormat(\r\n  'en-IN', { maximumSignificantDigits: 3 }\r\n);\r\n\r\nexport const percentageDisplay = (number) => (\r\n  __percentageDisplayFormater.format(number)\r\n);\r\n\r\nexport const dateString = (date) => (\r\n  `${pad(date.getMonth() + 1, 2)}-${pad(date.getDate(), 2)}-${date.getFullYear()}`\r\n);\r\n\r\nexport const dateDisplay = (date) => (\r\n  `${pad(date.getDate(), 2)}.${pad(date.getMonth() + 1, 2)}.${date.getFullYear()}`\r\n);\r\n","import React, { Fragment } from 'react';\r\nimport { condenseData } from '../../utilities/data-mutations';\r\nimport { bigIntegerDisplay, percentageDisplay } from '../../utilities/formatting';\r\nimport './data-panel.css';\r\n\r\nconst DataPanel = (props) => {\r\n  const {\r\n    data,\r\n    currentTime,\r\n    chartsExpanded,\r\n    onToggleFilters,\r\n    onToggleCharts,\r\n  } = props;\r\n  const confirmedValues = condenseData('confirmed', data),\r\n        recoveredValues = condenseData('recovered', data),\r\n        deathsValues = condenseData('deaths', data);\r\n  const condensedDataCurrent = {\r\n    confirmed: confirmedValues[currentTime],\r\n    recovered: recoveredValues[currentTime],\r\n    deaths: deathsValues[currentTime],\r\n  }\r\n  const controlHandlers = { onToggleFilters, onToggleCharts }\r\n  const clsCharts = `charts-container ${chartsExpanded ? 'expanded' : ''}`\r\n  return(\r\n    <Fragment>\r\n      <div className=\"data-panel\">\r\n        <DataPanelTiles {...condensedDataCurrent} />\r\n        <DataPanelControls {...controlHandlers} />\r\n      </div>\r\n      <div className={clsCharts}></div>\r\n    </Fragment>\r\n  );\r\n}\r\n\r\nconst DataPanelTiles = ({ confirmed, deaths, recovered }) => {\r\n  return(\r\n    <Fragment>\r\n      <DataPanelTile cls=\"confirmed\" heading=\"Confirmed\">\r\n        {bigIntegerDisplay(confirmed)}\r\n      </DataPanelTile>\r\n      <DataPanelTile cls=\"recovered\" heading=\"Recovered\">\r\n        {bigIntegerDisplay(recovered)}\r\n      </DataPanelTile>\r\n      <DataPanelTile cls=\"deaths\" heading=\"Deaths\">\r\n        {bigIntegerDisplay(deaths)}\r\n      </DataPanelTile>\r\n      <DataPanelTile cls=\"computations\" heading=\"Computations\">\r\n        <div>\r\n          Active cases: {bigIntegerDisplay(confirmed - deaths - recovered)}\r\n        </div>\r\n        <div>\r\n          Recover rate: {`${percentageDisplay(recovered / confirmed * 100)}%`}\r\n        </div>\r\n        <div>\r\n          Mortality rate: {`${percentageDisplay(deaths / confirmed * 100)}%`}\r\n        </div>\r\n      </DataPanelTile>\r\n    </Fragment>\r\n  );\r\n}\r\n\r\nconst DataPanelTile = ({ cls, heading, children }) => {\r\n  cls = `data-panel__tile ${cls}`;\r\n  return(\r\n    <div className={cls}>\r\n      <div className=\"data-panel__tile__heading\">{heading}</div>\r\n      <div className=\"data-panel__tile__content\">{children}</div>\r\n    </div>\r\n  );\r\n}\r\n\r\nconst DataPanelControls = ({ onToggleFilters, onToggleCharts }) => {\r\n  return(\r\n    <div className=\"data-panel__controls\">\r\n      <span onClick={onToggleFilters}>\r\n        <FilterIcon />\r\n      </span>\r\n      <span onClick={onToggleCharts}>\r\n        <ArrowLeftIcon />\r\n      </span>\r\n    </div>\r\n  );\r\n}\r\n\r\n/*\r\nconst LiveDataComputations = ({\r\n  confirmed, deaths, recovered, children\r\n}) => {\r\n  return(\r\n    <div className=\"data-panel-computations__block\">\r\n      <div className=\"data-panel-computations__metric\">\r\n        <span className=\"data-panel-computations__metric-key\">\r\n          Active cases:&nbsp;\r\n        </span>\r\n        <span className=\"data-panel-computations__metric-value\">\r\n          {bigIntegerDisplay(confirmed - deaths - recovered)}\r\n        </span>\r\n      </div>\r\n      <div className=\"data-panel-computations__metric\">\r\n        <span className=\"live-data-panel-computations__metric-key\">\r\n          Recover rate:&nbsp;\r\n        </span>\r\n        <span className=\"data-panel-computations__metric-value\">\r\n          {`${percentageDisplay(recovered / confirmed * 100)}%`}\r\n        </span>\r\n      </div>\r\n      <div className=\"data-panel-computations__metric\">\r\n        <span className=\"data-panel-computations__metric-key\">\r\n          Mortality rate:&nbsp;\r\n        </span>\r\n        <span className=\"data-panel-computations__metric-value\">\r\n          <span className=\"data-panel-computations__fatal\">\r\n            {`${percentageDisplay(deaths / confirmed * 100)}%`}\r\n          </span>\r\n        </span>\r\n      </div>\r\n      <div className=\"data-panel-computations__block-description\">\r\n        {children}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n*/\r\n\r\nconst FilterIcon = () => (\r\n  <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\">\r\n    <path d=\"M1 0l9 15.094v5.906l4 3v-8.906l9-15.094h-22zm18.479 2l-2.981 5h-8.996l-2.981-5h14.958z\" />\r\n  </svg>\r\n);\r\n\r\nconst ArrowLeftIcon = () => (\r\n  <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\">\r\n    <path d=\"M24 11.871l-5-4.871v3h-19v4h19v3z\" />\r\n  </svg>\r\n);\r\n\r\nexport default DataPanel;\r\n","import React from 'react';\r\nimport './loader.css';\r\n\r\nconst Loader = () => {\r\n  return(\r\n    <div className=\"loader-wrapper\">\r\n      <div className=\"loader-title\">COVID-19 Map</div>\r\n      <div className=\"loader\">\r\n        {[...Array(25).keys()].map((key) => <div key={key}></div>)}\r\n      </div>\r\n\t  </div>\r\n  );\r\n}\r\n\r\nexport default Loader;\r\n","const __DATA__MOCKUP = {\r\n  1584820500000: [\r\n    {\r\n      province: 'Auenland',\r\n      country: 'Eriador',\r\n      latlng: [51, 9],\r\n      confirmed: 10000,\r\n      recovered: 1,\r\n      deaths: 5000,\r\n      active: 4999,\r\n    },\r\n    {\r\n      province: 'Hyarrostar',\r\n      country: 'Númenor',\r\n      latlng: [52, 10],\r\n      confirmed: 100000,\r\n      recovered: 1000,\r\n      deaths: 60000,\r\n      active: 39000,\r\n    },\r\n    {\r\n      province: 'Gorgoroth',\r\n      country: 'Mordor',\r\n      latlng: [50, 7],\r\n      confirmed: 20,\r\n      recovered: 0,\r\n      deaths: 0,\r\n      active: 20,\r\n    }\r\n  ],\r\n  1584820800000: [\r\n    {\r\n      province: 'Auenland',\r\n      country: 'Eriador',\r\n      latlng: [51, 9],\r\n      confirmed: 20000,\r\n      recovered: 10,\r\n      deaths: 15000,\r\n      active: 9990,\r\n    },\r\n    {\r\n      province: 'Hyarrostar',\r\n      country: 'Númenor',\r\n      latlng: [52, 10],\r\n      confirmed: 100000,\r\n      recovered: 40000,\r\n      deaths: 60000,\r\n      active: 0,\r\n    },\r\n    {\r\n      province: 'Gorgoroth',\r\n      country: 'Mordor',\r\n      latlng: [50, 7],\r\n      confirmed: 50,\r\n      recovered: 10,\r\n      deaths: 20,\r\n      active: 20,\r\n    }\r\n  ],\r\n  1584820813832: [\r\n    {\r\n      province: 'Auenland',\r\n      country: 'Eriador',\r\n      latlng: [51, 9],\r\n      confirmed: 100000,\r\n      recovered: 20,\r\n      deaths: 50000,\r\n      active: 49980,\r\n    },\r\n    {\r\n      province: 'Hyarrostar',\r\n      country: 'Númenor',\r\n      latlng: [52, 10],\r\n      confirmed: 160000,\r\n      recovered: 80000,\r\n      deaths: 65000,\r\n      active: 15000,\r\n    },\r\n    {\r\n      province: 'Gorgoroth',\r\n      country: 'Mordor',\r\n      latlng: [50, 7],\r\n      confirmed: 200,\r\n      recovered: 40,\r\n      deaths: 80,\r\n      active: 80,\r\n    }\r\n  ]\r\n}\r\n\r\nexport default __DATA__MOCKUP;\r\n","import React, { Component } from 'react';\nimport { usePromiseTracker, trackPromise } from 'react-promise-tracker';\nimport Modal from 'react-responsive-modal';\nimport Select from 'react-select';\nimport DataMap from './components/data-map/data-map';\nimport DataPanel from './components/data-panel/data-panel';\nimport Loader from './components/loader/loader';\nimport { filterPropValuePair } from './utilities/data-mutations';\n//import { shiftDateBack } from './utilities/datetime';\n//import { dateString } from './utilities/formatting';\nimport { interfaceOutGeoJSON } from './utilities/interfaces';\nimport './App.css';\n\nimport __DATA__MOCKUP from './data-mockup';\n\nconst __SATELLITE = 'satellite-v9';\nconst __LIGHTMODE = 'light-v10';\nconst __DARKMODE = 'dark-v10';\nconst __STREETS = 'streets-v11';\n\nconst permuteMapStyles = (currentValue) => {\n  switch(currentValue) {\n    case __SATELLITE:\n      return __LIGHTMODE;\n    case __LIGHTMODE:\n      return __DARKMODE;\n    case __DARKMODE:\n      return __STREETS;\n    case __STREETS:\n      return __SATELLITE;\n    default:\n      console.log(`Sorry, the style '${currentValue}' doesn't exist.`);\n  }\n}\n\nconst LoadingIndicator = () => {\n  const { promiseInProgress } = usePromiseTracker({ delay: 3000 });\n  return(promiseInProgress && <Loader />);  \n}\n\nexport default class App extends Component {\n  constructor() {\n    super();\n    this.state = {\n      mapStyle: __DARKMODE,\n      data: {\n        fetched: {},\n        filtered: {},\n      },\n      survey: {},\n      currentTime: 1584820813832,\n      filteredRegions: [],\n      chartsExpanded: false,\n      filtersExpanded: false,\n    }\n    this.registeredRegions = null;\n  }\n\n  handleReload = () => {\n    document.location.reload();\n  }\n\n  handleSwitchTheme = () => {\n    const { mapStyle } = this.state;\n    this.setState({ mapStyle: permuteMapStyles(mapStyle) });\n  }\n\n  handleSetLive = () => {\n    this.setState({\n      currentTime: Date.now(),\n    });\n  }\n\n  handleToggleCharts = () => {\n    this.setState({\n      chartsExpanded: !this.state.chartsExpanded,\n    });\n  }\n\n  handleCollapseCharts = () => {\n    this.setState({ chartsExpanded: false });\n  }\n\n  handleToggleFilters = () => {\n    this.setState({\n      filtersExpanded: !this.state.filtersExpanded,\n    });\n  }\n\n  handleCollapseFilters = () => {\n    this.setState({ filtersExpanded: false });\n  }\n\n  setCountryFilter = (filteredRegions) => {\n    this.setState({ filteredRegions });\n    let { data } = this.state;\n    const { fetched } = data;\n    if(!!filteredRegions && filteredRegions.length > 0) {\n      filteredRegions = filteredRegions.map(r => r.value);\n      data.filtered = filterPropValuePair(['province', 'country'], filteredRegions, fetched);\n    } else {\n      data.filtered = data.fetched;\n    }\n    this.setState({ data });\n  }\n\n  setTime = (unixtime) => {\n    this.setState({\n      currentTime: unixtime,\n    });\n  }\n\n  getLiveData = async () => {\n    // TODO: fetch from backend here\n    return __DATA__MOCKUP;\n  }\n\n  async componentDidMount() {\n    const data = await this.getLiveData();\n    this.setState({\n      data: {\n        fetched: data,\n        filtered: data,\n      }\n    });\n    // TODO: get from endpoint '/getAllRegisteredRegions'\n    this.registeredRegions = [\n      { value: 'Auenland', label: 'Auenland' },\n      { value: 'Eriador', label: 'Eriador' },\n      { value: 'Hyarrostar', label: 'Hyarrostar' },\n      { value: 'Númenor', label: 'Númenor' },\n      { value: 'Gorgoroth', label: 'Gorgoroth' },\n      { value: 'Mordor', label: 'Mordor' },\n    ]\n  }\n\n  render(){\n    const {\n      state,\n      registeredRegions,\n      setCountryFilter,\n      handleToggleCharts,\n      handleCollapseCharts,\n      handleToggleFilters,\n      handleCollapseFilters,\n    } = this;\n    const {\n      mapStyle,\n      data: {filtered},\n      //survey,\n      currentTime,\n      filteredRegions,\n      chartsExpanded,\n      filtersExpanded,\n    } = state;\n\n    const geoData = interfaceOutGeoJSON(filtered[currentTime]);\n\n    return(\n      <div className=\"app\">\n        <LoadingIndicator />\n        <Modal\n          open={filtersExpanded}\n          onClose={handleCollapseFilters}\n          classNames={{ modal: 'modal-filters' }}\n          center\n        >\n          <h2>Data filters</h2>\n          <Select\n            isMulti\n            name=\"countries\"\n            options={registeredRegions}\n            defaultValue={filteredRegions}\n            onChange={setCountryFilter}\n          />\n        </Modal>\n        <DataPanel\n          data={filtered}\n          currentTime={currentTime}\n          chartsExpanded={chartsExpanded}\n          onToggleFilters={handleToggleFilters}\n          onToggleCharts={handleToggleCharts}\n        />\n        {geoData && <DataMap\n          data={geoData}\n          mapStyle={mapStyle}\n          onClick={handleCollapseCharts}\n        />}\n      </div>\n    );\n  }\n}\n","export const interfaceOutGeoJSON = (dataset) => {\r\n  let geoData = {\r\n    type: 'FeatureCollection',\r\n    features: [],\r\n  }\r\n  if(dataset) {\r\n    let geodataFeatures = [];\r\n    for(const point of dataset){\r\n      const {\r\n        province,\r\n        country,\r\n        confirmed,\r\n        recovered,\r\n        deaths,\r\n        latlng,\r\n      } = point;\r\n      const [ lat, lng ] = latlng;\r\n      geodataFeatures.push({\r\n        type: 'Feature',\r\n        properties: {\r\n          province,\r\n          country,\r\n          confirmed: Number(confirmed),\r\n          recovered: Number(recovered),\r\n          deaths: Number(deaths),\r\n        },\r\n        geometry: {\r\n          type: 'Point',\r\n          coordinates: [Number(lng), Number(lat)],\r\n        }\r\n      });\r\n    }\r\n    geoData.features = geodataFeatures;\r\n  }\r\n  return geoData;\r\n}\r\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}